
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="035ff16e-36a4-5ef2-944f-2ab991fb8624")}catch(e){}}();
(()=>{"use strict";const t="0.509.0",e="https://js.trendmd.com";let i=function(t){return t[t.NONE=0]="NONE",t[t.BEFORE_END=1]="BEFORE_END",t[t.AFTER_BEGIN=2]="AFTER_BEGIN",t[t.REPLACE=3]="REPLACE",t}({});class Gdpr{constructor(){this.gdpr=!1,this.trConsent=!1,this.prConsent=!1,this.gaConsent=!1,this.gaConsentInGdpr=!1,this.gaClientId="",this.isAcs=!1,this.isUS=!1}set switches(t){}addGaTrackingCode(t,e,i){}setGaConsent(){}setPrConsent(){}setDns(){}static getInstance(){return null===Gdpr.instance&&(Gdpr.instance=new Gdpr),Gdpr.instance}}Gdpr.instance=null;class TrendMDInjector{constructor(t,e){this.debug=!1,this.version="1.0.0",this.apiEndpoint=void 0,this.polyfillsUrl=void 0,this.widgetUrl=void 0,this.gdprInstance=null,this.installed=!1,this.adSetId="trendmd",this.currentTime=null,this.config={},this.monitoredElements=new Set,this.window=t,this.version=e.version,this.apiEndpoint=e.apiEndpoint,this.polyfillsUrl=e.polyfillsUrl,this.widgetUrl=e.widgetUrl,this.debug=e.debug}register(t){this.log("Starting register"),t&&(this.config=Object.assign({},this.config,t),this.log("Registered config ",this.config))}gdpr(){return Gdpr.getInstance()}async run(){var t;if(this.installed)return void this.log("Injector already installed");this.installed=!0,this.log("TrendMD: injector running");const e=void 0!==window.crypto.randomUUID?window.crypto.randomUUID():"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(t=>{const e=parseInt(t,10);return((15&(e^crypto.getRandomValues(new Uint8Array(1))[0]))>>e/4).toString(16)})),i=Math.random().toString(16).slice(2);if(0===Object.keys(this.config).length){const t=this.window.document.querySelector("script[data-trendmdconfig]");if(t&&t.hasAttribute("data-trendmdconfig")){var n;const e=(null!=(n=t.getAttribute("data-trendmdconfig"))?n:"").trim();try{this.config=JSON.parse(e),this.log("Parsed config from script element")}catch(h){try{this.config=JSON.parse(decodeURIComponent(e).replace(/'/g,'"')),this.log("Parsed config from script element")}catch(c){this.log("Invalid config. Using default config")}}}}if(0===Object.keys(this.config).length){const t=this.window.location.search,e=new URLSearchParams(t);if(e){var s;if(this.log("UrlParams",[...e]),this.config={element:"#trendmd-suggestions"},e.has("url")&&(this.config.url=e.get("url"),this.window.actualUrl=this.config.url),e.has("title"))this.window.document.title=null!=(s=e.get("title"))?s:"";e.has("journal_id")&&(this.config.journal_id=e.get("journal_id"))}}0===Object.keys(this.config).length||"object"!=typeof this.config?(this.log("Setting default config"),this.config={element:"#trendmd-suggestions"}):this.config.element||(this.log("Setting default element"),this.config.element="#trendmd-suggestions"),this.config.url||(this.config.url=this.window.location.href),this.config.journal_id||(this.config.journal_id=null),this.log("Config ",this.config);const o=new Headers;o.set("X-Revops-Source-Url",this.config.url),o.set("X-Revops-Source-Type","2"),o.set("X-Revops-Version",this.version),o.set("X-Revops-Session-Id",e),o.set("X-Revops-Reference-Id",null!=(t=this.config.journal_id)?t:""),await fetch(`${this.apiEndpoint}/ad-sets/identifier`,{method:"GET",headers:o}).then((t=>{if(!t.ok)throw this.log("Error fetching adSetId"),new Error("Error fetching adSetId");return t})).then((t=>t.json())).then((t=>{this.log("Identifier fetched",t),t.identifier&&(this.adSetId=t.identifier,this.currentTime=t.currentTime,this.log("AdSetId",this.adSetId))})).catch((t=>{throw this.log("Error fetching adSetId",t),new Error("Error fetching adSetId")}));const r=[];let d={};await fetch(`${this.apiEndpoint}/ad-sets/${this.adSetId}/settings`,{method:"GET",headers:o}).then((t=>{if(!t.ok)throw this.log("Error fetching settings"),new Error("Error fetching settings");return t})).then((t=>t.json())).then((t=>{if(d=t,this.log("Settings fetched",t),t.adSlots&&0!==t.adSlots.length){for(const s of t.adSlots){var e,i,n;const t=null!=(e=null==(i=s.settings)?void 0:i.positionSelector)?e:this.config.element,o=null==(n=s.settings)?void 0:n.positionInjectType;r.push({adSlotId:s.identifier,selector:t,injectType:o})}this.log("AdSlots",r)}else this.log("No adSlots found")})).catch((t=>{throw this.log("Error fetching settings",t),new Error("Error fetching settings")})),this.replaceAdSlotElements(r,"initial");new MutationObserver((t=>{t.forEach((t=>{0!==t.addedNodes.length&&(this.log("Mutation observed"),this.replaceAdSlotElements(r,"mutation"))}))})).observe(this.window.document.body,{childList:!0,subtree:!0});const l=this.window.document.createElement("script");l.type="module",l.src=this.polyfillsUrl,l.onload=()=>{var t,e;this.log("TrendMD: polyfills loaded"),this.window.RevopsObject="rjs",this.window.rjs=this.window.rjs||(e=this.window,function(...t){(e.rjs.q=e.rjs.q||[]).push(t)}),this.window.rjs("config",{startTime:null!=(t=this.currentTime)?t:(new Date).getTime(),datasetId:"revops-suggestions",scriptId:i,id:this.adSetId,debug:this.debug,publicSettings:d});const n=this.window.document.createElement("script");n.async=!0,n.id=i,n.type="module",n.src=this.widgetUrl,n.onload=()=>{this.log("Widget initialized for adSetId "+this.adSetId)},this.window.document.head.appendChild(n),this.log("Widget loader injected")},this.window.document.head.appendChild(l),this.log("Polyfills loader injected")}replaceAdSlotElements(t,e){t.forEach((t=>{this.window.document.querySelectorAll(t.selector).forEach((n=>{if(this.monitoredElements.has(n))return void this.log("Element already processed");if(!n)return void this.log(`Element with selector ${t.selector} not found`);this.monitoredElements.add(n),this.log(`Rendering ${t.adSlotId} element from source ${e} with injectionType ${t.injectType}`);const s=this.window.document.createElement("ins");switch(s.setAttribute("data-revops-suggestions",t.adSlotId),s.setAttribute("observed","true"),t.injectType){case i.BEFORE_END:n.appendChild(s),this.log("Element processed by appending before end");break;case i.AFTER_BEGIN:n.prepend(s),this.log("Element processed by prepending after begin");break;case i.REPLACE:this.log("Element processed by replacing"),n.replaceWith(s);break;case i.NONE:n.appendChild(s),this.log("Element processed by appending child")}}))}))}log(...t){this.debug&&console.log("[TrendMD]: ",...t)}}(i=>{if(!i.TrendMD){i.TrendMD=new TrendMDInjector(i,{apiEndpoint:"https://rev.trendmd.com",polyfillsUrl:`${e}/polyfills.js?${t}`,widgetUrl:`${e}/widget.js?${t}`,version:t||"1.0.0",debug:!1});try{i.TrendMD.run()}catch(n){console.error("TrendMD: error running injector",n)}}})(window)})();
//# sourceMappingURL=trendmd.min.js.map
//# debugId=035ff16e-36a4-5ef2-944f-2ab991fb8624
